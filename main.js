(()=>{"use strict";const e=document.querySelector(".profile__button_action_edit"),t=document.querySelector(".popup__form_edit-content"),s=(document.querySelector(".profile__name"),document.querySelector(".profile__status"),document.querySelector(".popup__input_type_name")),o=document.querySelector(".popup__input_type_status"),n=document.querySelector(".profile__button_action_add"),i=document.querySelector(".popup__form_add-content"),r=(document.querySelector(".popup__input_type_place-name"),document.querySelector(".popup__input_type_place-url"),document.querySelector(".profile__avatar"),document.querySelector(".profile__button_action_edit-avatar")),a=document.querySelector(".popup__form_edit-avatar");class u{constructor(e,t,s,{handleDeleteButtonCLick:o},{handleLikeButtonClick:n},i){this._data=e,this._link=e.link,this._name=e.name,this._id=e._id,this._likes=e.likes,this._ownerId=e.owner._id,this._cardSelector=t,this._handleCardClick=s,this._handleDeleteButtonCLick=o,this._handleLikeButtonClick=n,this._userId=i.id}_getTemplate(){return document.querySelector(this._cardSelector).content.querySelector(".element").cloneNode(!0)}generateCard(){this._element=this._getTemplate(),this._setEventListeners();const e=this._element.querySelector(".element__image");return e.src=this._link,e.alt=this._name,this._element.querySelector(".element__title").textContent=this._name,this._removeDeleteButton(),this.setLikesNumber(this._data),this.setLikeButtonState(),this._element}_setEventListeners(){this._element.querySelector(".element__button_action_like").addEventListener("click",(()=>this._handleLikeButtonClick(this._likes))),this._element.querySelector(".element__button_action_delete").addEventListener("click",(()=>this._handleDeleteButtonCLick())),this._element.querySelector(".element__image").addEventListener("click",(()=>this._handleCardClick(this._name,this._link)))}likeButtonSwitch(){this._element.querySelector(".element__button_action_like").classList.toggle("element__button_action_like_active")}_removeDeleteButton(){this._userId!=this._ownerId&&this._element.querySelector(".element__button_action_delete").remove()}deleteCard(){this._element.closest(".element").remove(),this._element=null}setLikesNumber(e){0===e.likes.length?this._element.querySelector(".element__likes-number").textContent="":this._element.querySelector(".element__likes-number").textContent=e.likes.length}updateLikesNumber(e){this._likes=e.likes}setLikeButtonState(){this.isLiked()?this._element.querySelector(".element__button_action_like").classList.add("element__button_action_like_active"):this._element.querySelector(".element__button_action_like").classList.remove("element__button_action_like_active")}isLiked(){return this._likes.some((e=>e._id===this._userId))}}const l=class{constructor(e,t){this._config=e,this._form=t,this._inputsList=[...this._form.querySelectorAll(this._config.inputSelector)],this._button=this._form.querySelector(this._config.submitButtonSelector)}_showError(e){const t=this._form.querySelector(`.${e.id}-input-error`);e.classList.add(this._config.inputErrorClass),t.classList.add(this._config.errorClass),t.textContent=e.validationMessage}_hideError(e){const t=this._form.querySelector(`.${e.id}-input-error`);e.classList.remove(this._config.inputErrorClass),t.classList.remove(this._config.errorClass),t.textContent=""}_hideInputErrors(){this._inputsList.forEach((e=>this._hideError(e)))}_handlerFieldValidation(e){e.validity.valid?this._hideError(e):this._showError(e)}_hasInvalidInput(){return this._inputsList.some((e=>!e.validity.valid))}_setSubmitButtonState(){this._hasInvalidInput()?(this._button.disabled=!0,this._button.classList.add(this._config.inactiveButtonClass)):(this._button.classList.remove(this._config.inactiveButtonClass),this._button.disabled=!1)}_setFormListeners(){this._form.addEventListener("submit",(e=>e.preventDefault())),this._inputsList.forEach((e=>{e.addEventListener("input",(()=>{this._handlerFieldValidation(e),this._setSubmitButtonState()}))})),this._setSubmitButtonState()}setFormState(){this._setSubmitButtonState(),this._hideInputErrors()}enableValidation(){this._setFormListeners(this._form)}},_={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};class c{constructor(e){this._popup=document.querySelector(e),this._handleEscClose=this._handleEscClose.bind(this)}open(){this._popup.classList.add("popup_isopen"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("popup_isopen"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(e){"Escape"===e.key&&this.close()}_handleOverlayClose(e){e.target.classList.contains("popup")&&this.close()}setEventListeners(){this._popup.querySelector(".popup__button_action_close").addEventListener("click",(()=>this.close())),this._popup.addEventListener("click",(e=>this._handleOverlayClose(e)))}}class h extends c{constructor(e,t){super(e),this._formSubmitHandler=t,this._popupForm=this._popup.querySelector(".popup__form"),this._popupButton=this._popup.querySelector(".popup__button"),this._popupButtonSubmit=this._popup.querySelector(".popup__button_action_submit"),this._cache=this._popupButtonSubmit.textContent,this._inputsList=[...this._popup.querySelectorAll(".popup__input")]}_getInputValues(){return this._inputsValues={},this._inputsList.forEach((e=>{this._inputsValues[e.name]=e.value})),this._inputsValues}setEventListeners(){this._popupForm.addEventListener("submit",(e=>{e.preventDefault(),this._formSubmitHandler(this._getInputValues())})),super.setEventListeners()}close(){this._popupForm.reset(),super.close()}renderLoading(e){this._popupButtonSubmit.textContent=e?"Сохранение...":this._cache}}const p=new class{constructor({adress:e,cohortID:t,token:s}){this.adress=e,this.cohortID=t,this.token=s}getProfileInfo(){return fetch(`${this.adress}/v1/${this.cohortID}/users/me`,{headers:{authorization:this.token}}).then((e=>e.ok?e.json():Promise.reject(`Ошибка при получении дынных профиля ${e.status}`)))}getInitialCards(){return fetch(`${this.adress}/v1/${this.cohortID}/cards`,{headers:{authorization:this.token}}).then((e=>e.ok?e.json():Promise.reject(`Ошибка при получении данных карточек ${e.status}`)))}editProfileData(e){return fetch(`${this.adress}/v1/${this.cohortID}/users/me`,{method:"PATCH",headers:{authorization:this.token,"Content-Type":"application/json"},body:JSON.stringify({name:e.name,about:e.about})}).then((e=>e.ok?e.json():Promise.reject(`Ошибка при изменении данных профиля ${e.status}`)))}createCard(e){return fetch(`${this.adress}/v1/${this.cohortID}/cards`,{method:"POST",headers:{authorization:this.token,"Content-Type":"application/json"},body:JSON.stringify({name:e.name,link:e.link})}).then((e=>e.ok?e.json():Promise.reject(`Ошибка при создании новой карточки ${e.status}`)))}deleteCard(e){return fetch(`${this.adress}/v1/${this.cohortID}/cards/${e._id}`,{method:"DELETE",headers:{authorization:this.token}}).then((e=>e.ok?e.json():Promise.reject(`Ошибка при удалении карточки ${e.status}`)))}likeCard(e){return fetch(`${this.adress}/v1/${this.cohortID}/cards/${e._id}/likes`,{method:"PUT",headers:{authorization:this.token}}).then((e=>e.ok?e.json():Promise.reject(`Ошибка при постановке лайка ${e.status}`)))}deleteLike(e){return fetch(`${this.adress}/v1/${this.cohortID}/cards/${e._id}/likes`,{method:"DELETE",headers:{authorization:this.token}}).then((e=>e.ok?e.json():Promise.reject(`Ошибка при снятии лайка ${e.status}`)))}editAvatar(e){return fetch(`${this.adress}/v1/${this.cohortID}/users/me/avatar`,{method:"PATCH",headers:{authorization:this.token,"Content-Type":"application/json"},body:JSON.stringify({avatar:e.avatar})}).then((e=>e.ok?e.json():Promise.reject(`Ошибка при изменении аватара профиля ${e.status}`)))}}({adress:"https://mesto.nomoreparties.co",cohortID:"cohort-32",token:"6d2de758-1877-4081-94a9-68820dbef110"});let d;Promise.all([p.getProfileInfo(),p.getInitialCards()]).then((([e,t])=>{L.setUserAvatar(e),L.setUserInfo(e),d=L.getUserId(e),v.renderItems(t)})).catch((e=>{console.log("Ошибка",e)}));const m=new class extends c{constructor(e){super(e),this._popupImage=this._popup.querySelector(".popup__image"),this._popupCaption=this._popup.querySelector(".popup__caption")}open(e,t){this._popupImage.src=t,this._popupImage.alt=e,this._popupCaption.textContent=e,super.open()}}(".popup_type_show-image");function k(e,t){m.open(e,t)}m.setEventListeners();const f=new class extends c{constructor(e,{formSubmitHandler:t}){super(e),this._popupForm=this._popup.querySelector(".popup__form"),this._formSubmitHandler=t}setSubmitAction(e){this._formSubmitHandler=e}setEventListeners(){this._popupForm.addEventListener("submit",(e=>{e.preventDefault(),this._formSubmitHandler()})),super.setEventListeners()}}(".popup_type_confirm",{formSubmitHandler:()=>{}});function S(e){const t=new u(e,".element-template",k,{handleDeleteButtonCLick:()=>{f.open(),f.setSubmitAction((()=>{p.deleteCard(t).then((()=>{t.deleteCard()})).catch((e=>{console.log("Ошибка",e)})),f.close()}))}},{handleLikeButtonClick:()=>{t.isLiked()?p.deleteLike(t).then((e=>{t.likeButtonSwitch(),t.setLikesNumber(e),t.updateLikesNumber(e)})).catch((e=>{console.log("Ошибка",e)})):p.likeCard(t).then((e=>{t.likeButtonSwitch(),t.setLikesNumber(e),t.updateLikesNumber(e)})).catch((e=>{console.log("Ошибка",e)}))}},d);return t.generateCard()}f.setEventListeners();const v=new class{constructor({renderer:e},t){this._renderer=e,this._container=document.querySelector(t)}renderItems(e){e.forEach((e=>{this._renderer(e)}))}addItem(e,t=!1){t?this._container.append(e):this._container.prepend(e)}}({renderer:e=>{const t=S(e);v.addItem(t,!0)}},".elements"),L=new class{constructor(e,t,s){this._name=document.querySelector(e),this._status=document.querySelector(t),this._avatar=document.querySelector(s)}getUserInfo(){return this._userInfo={name:this._name.textContent,status:this._status.textContent},this._userInfo}setUserInfo(e){this._profileData=e,this._name.textContent=this._profileData.name,this._status.textContent=this._profileData.about}getUserId(e){return this._userId={id:e._id}}setUserAvatar(e){this._avatar.src=e.avatar}}(".profile__name",".profile__status",".profile__avatar"),y=new h(".popup_type_edit",(function(e){const t={name:e.name,about:e.status};y.renderLoading(!0),p.editProfileData(t).then((e=>L.setUserInfo(e))).catch((e=>{console.log("Ошибка",e)})).finally((()=>{y.renderLoading(!1)})),y.close()}));y.setEventListeners();const b=new l(_,t);b.enableValidation(),e.addEventListener("click",(()=>function(){const e=L.getUserInfo();s.value=e.name,o.value=e.status,b.setFormState(),y.open()}()));const C=new h(".popup_type_add",(function(e){const t={name:e.name,link:e.url};C.renderLoading(!0),p.createCard(t).then((e=>{const t=S(e);v.addItem(t)})).finally((()=>{C.renderLoading(!1)})),C.close()}));C.setEventListeners();const g=new l(_,i);g.enableValidation(),n.addEventListener("click",(()=>{g.setFormState(),C.open()}));const E=new h(".popup_type_edit-avatar",(function(e){E.renderLoading(!0),p.editAvatar(e).then((e=>{L.setUserAvatar(e),E.close()})).catch((e=>{console.log("Ошибка",e)})).finally((()=>{E.renderLoading(!1)}))}));E.setEventListeners();const I=new l(_,a);I.enableValidation(),r.addEventListener("click",(()=>{I.setFormState(),E.open()}))})();